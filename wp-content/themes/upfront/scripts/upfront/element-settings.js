(function(e){define([],function(){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views,t=Backbone.View.extend({id:"settings",events:{"click .upfront-save_settings":"saveSettings"},initialize:function(e){this.options=e,this.panels=_([])},saveSettings:function(){this.panels.each(function(e){e.save_settings()}),this.model.get("properties").trigger("change"),Upfront.Events.trigger("element:settings:saved"),Upfront.Events.trigger("element:settings:deactivate"),_upfront_post_data.layout.specificity&&_upfront_post_data.layout.item&&!_upfront_post_data.layout.item.match(/-page/)?Upfront.Events.trigger("command:layout:save_as"):Upfront.Events.trigger("command:layout:save")},get_title:function(){return e.settings},render:function(){var t=this;t.$el.html('<div class="upfront-settings_title">'+this.get_title()+"</div>"),Upfront.Events.trigger("settings:prepare"),t.panels.each(function(e){e.render(),t.listenTo(e,"upfront:settings:panel:toggle",t.toggle_panel),t.listenTo(e,"upfront:settings:panel:close",t.close_panel),t.listenTo(e,"upfront:settings:panel:refresh",t.refresh_panel),e.parent_view=t,t.$el.append(e.el)}),this.toggle_panel(this.panels.first());var n=this.panels.first().$el.find(".upfront-settings_label").outerWidth(),r=this.panels.first().$el.find(".upfront-settings_panel").outerWidth();this.$el.addClass("upfront-ui"),this.$el.append("<div class='upfront-settings-button_panel'><button type='button' class='upfront-save_settings'><i class='icon-ok'></i> "+e.save+"</button>"+"</div>")},set_title:function(e){if(!e||!e.length)return!1;this.$el.find(".upfront-settings_title").html(e)},toggle_panel:function(e){this.panels.invoke("conceal"),e.$el.find(".upfront-settings_panel").css("height",""),e.show(),e.reveal(),this.set_title(e.get_title())},refresh_panel:function(e){e.is_active()&&this.toggle_panel(e)},close_panel:function(e){this.panels.invoke("conceal"),this.panels.invoke("show"),this.set_title(this.get_title())},cleanUp:function(){this.panels&&this.panels.each(function(e){e.cleanUp()}),this.remove()}});return t})})(jQuery);