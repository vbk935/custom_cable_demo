(function(e){define([],function(){var t=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views,n=Backbone.View.extend(_.extend({},Upfront.Views.Mixins.Upfront_Scroll_Mixin,{className:"upfront-settings_panel_wrap",hide_common_anchors:!1,hide_common_fields:!1,events:{"click .upfront-cancel_settings":"on_cancel","click .upfront-settings_label":"on_toggle","click .upfront-settings-common_panel .upfront-settings-item-title":"on_toggle_common"},get_title:function(){return this.options.title?this.options.title:""},get_label:function(){return this.options.label?this.options.label:""},initialize:function(e){var t=this;this.hide_common_fields=_.isUndefined(e.hide_common_fields)?!1:e.hide_common_fields,this.hide_common_anchors=_.isUndefined(e.hide_common_anchors)?!1:e.hide_common_anchors,t.options=e,this.settings=e.settings?_(e.settings):_([]),this.settings.each(function(e){e.panel=t,e.trigger("panel:set")}),this.tabbed=typeof e.tabbed!="undefined"?e.tabbed:this.tabbed},tabbed:!1,is_changed:!1,render:function(){this.$el.html('<div class="upfront-settings_label" /><div class="upfront-settings_panel" ><div class="upfront-settings_panel_scroll" />');var e=this.$el.find(".upfront-settings_label"),n=this.$el.find(".upfront-settings_panel"),r=this.$el.find(".upfront-settings_panel_scroll"),i,s=this;e.append(this.get_label()),this.settings.each(function(e){e.panel||(e.panel=s),e.render(),r.append(e.el)}),this.options.min_height&&r.css("min-height",this.options.min_height);if(this.tabbed){var o=this.settings.first();o.radio||o.reveal(),r.append('<div class="upfront-settings-tab-height" />')}this.stop_scroll_propagation(r);if(this.hide_common_fields===!1){this.$el.find(".upfront-settings_panel_scroll").after('<div class="upfront-settings-common_panel"></div>'),i=this.$el.find(".upfront-settings-common_panel");if(typeof this.cssEditor=="undefined"||this.cssEditor){var u=new Upfront.Views.Editor.Settings.Settings_CSS({model:this.model,title:!1===this.hide_common_anchors?t.css_and_anchor:t.css_styles});u.panel=s,u.render(),i.append(u.el)}if(this.hide_common_anchors===!1){var a=new Upfront.Views.Editor.Settings.AnchorSetting({model:this.model});a.panel=s,a.render(),i.append(a.el)}}this.$el.fadeIn("fast",function(){var e=s.$el.parent(),t=(e.offset()?e.offset().top:0)+e.height(),n=jQuery(window).height();t+60>n+jQuery("body").scrollTop()&&jQuery("body").animate({scrollTop:t-n+60},"slow")}),this.trigger("rendered")},on_toggle_common:function(){var e=this,n=this.$el.find(".upfront-settings-common_panel");n.toggleClass("open"),n.is(".open")?this.$el.find(".upfront-settings-common_panel .upfront-settings-item-title span").first().html(t.element_css_styles):this.$el.find(".upfront-settings-common_panel .upfront-settings-item-title span").first().html(!1===e.hide_common_anchors?t.css_and_anchor:t.css_styles)},conceal:function(){this.$el.find(".upfront-settings_panel").hide(),this.$el.find(".upfront-settings_label").removeClass("active"),this.trigger("concealed")},reveal:function(){this.$el.find(".upfront-settings_label").addClass("active"),this.$el.find(".upfront-settings_panel").show();if(this.tabbed){var t=0;this.$el.find(".upfront-settings-item-tab-content").each(function(){var n=e(this).outerHeight(!0);t=n>t?n:t}),this.$el.find(".upfront-settings-tab-height").css("height",t)}this.trigger("revealed")},show:function(){this.$el.show()},hide:function(){this.$el.hide()},is_active:function(){return this.$el.find(".upfront-settings_panel").is(":visible")},on_toggle:function(){this.trigger("upfront:settings:panel:toggle",this),this.show()},start_loading:function(e,t){this.loading=new Upfront.Views.Editor.Loading({loading:e,done:t}),this.loading.render(),this.$el.find(".upfront-settings_panel").append(this.loading.$el)},end_loading:function(e){this.loading?this.loading.done(e):e()},save_settings:function(){if(!this.settings)return!1;var e=this;this.settings.each(function(t){if((t.fields||t.settings).size()>0)t.save_fields();else{var n=e.model.get_property_value_by_name(t.get_name());n!=t.get_value()&&e.model.set_property(t.get_name(),t.get_value())}})},on_cancel:function(){this.trigger("upfront:settings:panel:close",this)},cleanUp:function(){this.settings&&this.settings.each(function(e){e.remove()}),this.$el.off(),this.remove()}}));return n})})(jQuery);