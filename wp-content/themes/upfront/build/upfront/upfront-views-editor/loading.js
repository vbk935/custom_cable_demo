!function(n){upfrontrjs.define([],function(){return Backbone.View.extend({className:"upfront-loading",is_done:!1,done_callback:[],done_timeout:!1,initialize:function(n){this.options=n},render:function(){var n=this;this.$el.html('<div class="upfront-loading-ani" />'),this.options.fixed&&this.$el.addClass("upfront-loading-fixed"),this.options.loading_type&&this.$el.addClass(this.options.loading_type),this.options.loading&&this.$el.append('<p class="upfront-loading-text">'+this.options.loading+"</p>"),this.options.loading_notice&&this.$el.append('<p class="upfront-loading-notice">'+this.options.loading_notice+"</p>"),n.options.remove_on_event&&Upfront.Events.once(n.options.remove_on_event,function(){n.remove(),clearTimeout(n.done_timeout),n.done_callback&&_(n.done_callback).each(function(o){o&&o.call&&o.call(n)})}),this.$el.find(".upfront-loading-ani").on("animationend webkitAnimationEnd MSAnimationEnd oAnimationEnd",function(){var o=n.$el.hasClass("upfront-loading-repeat")?"repeat":n.$el.hasClass("upfront-loading-done")?"done":"start";if("start"==o)if(n.is_done&&!n.options.remove_on_event){var e=n.done_text||n.options.done;n.$el.addClass("upfront-loading-done"),n.$el.find(".upfront-loading-text").text(e)}else n.$el.addClass("upfront-loading-repeat");else if("repeat"==o)n.$el.removeClass("upfront-loading-repeat");else if("done"==o){if(n.options.remove_on_event)return;n.remove(),clearTimeout(n.done_timeout),n.done_callback&&_(n.done_callback).each(function(o){o&&o.call&&o.call(n)})}})},update_loading_text:function(n){this.$el.find(".upfront-loading-text").text(n)},on_finish:function(n){this.done_callback.push(n)},done:function(n,o){var e=this,t=e.options.timeout||6e3;this.is_done=!0,this.done_timeout=setTimeout(function(){e&&(e.remove(),_(e.done_callback).each(function(n){n&&n.call&&n.call(e)}))},t),n&&n.call(e),this.done_text=o},cancel:function(n,o){this.remove(),n&&n()}})})}(jQuery);