!function(e){var t=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;upfrontrjs.define(["scripts/upfront/upfront-views-editor/mixins","scripts/upfront/upfront-views-editor/theme-colors","text!upfront/templates/color_picker.html"],function(i,s,l){var n=Backbone.View.extend({className:"upfront-field-wrap",initialize:function(e){this.options=e,this.multiple="undefined"!=typeof this.options.multiple?this.options.multiple:"undefined"!=typeof this.multiple&&this.multiple,this.label="undefined"!=typeof this.options.label?this.options.label:"",this.default_value="undefined"!=typeof this.options.default_value?this.options.default_value:this.multiple?[]:"",this.options.property?(this.property=this.model.get_property_by_name(this.options.property),this.property===!1&&(this.model.init_property(this.options.property,this.default_value),this.property=this.model.get_property_by_name(this.options.property)),this.property_name=this.options.property,"undefined"!=typeof this.options.use_breakpoint_property&&(this.use_breakpoint_property=this.options.use_breakpoint_property)):this.property=!1,this.name=this.options.name?this.options.name:this.cid,this.selected_state=this.selected_state?this.selected_state:"",this.options.init&&this.options.init(),this.init&&this.init(),this.options.change&&this.on("changed",this.options.change,this),this.options.show&&this.on("changed rendered",this.dispatch_show,this),this.options.focus&&this.on("focus",this.options.focus,this),this.options.blur&&this.on("blur",this.options.blur,this),this.options.rendered&&this.on("rendered",this.options.rendered,this),this.options.on_click&&(this.on_click=this.options.on_click),this.once("rendered",function(){var e=this;this.get_field().on("focus",function(){e.trigger("focus")}).on("blur",function(){e.trigger("blur")})},this)},dispatch_show:function(){var e=this;setTimeout(function(){e.options.show(e.get_value(),e.$el)},100)},get_name:function(){return this.property?this.property.get("name"):this.name},get_saved_value:function(){if(this.property)return this.use_breakpoint_property?this.model.get_breakpoint_property_value(this.property_name,!0):this.property.get("value");if(this.model){var e=this.model.get(this.name);return e?e:this.default_value}return this.default_value},get_value:function(){var t=this.get_field();return!this.multiple||1==t.size()&&t.is("select")?t.val():_.map(t,function(t){return e(t).val()})},set_value:function(e){this.get_field().val(e)},get_field_id:function(){return this.cid+"-"+this.get_name()},get_field_name:function(){return this.get_name()},get_field:function(){return this.$el.find("[name="+this.get_field_name()+"]"+(this.selected_state?":"+this.selected_state:""))},get_label_html:function(){if(this.options.hide_label===!0)return"";var e={for:this.get_field_id(),class:"upfront-field-label "+("inline"==this.options.label_style?"upfront-field-label-inline":"upfront-field-label-block")};return"<label "+this.get_field_attr_html(e)+">"+this.label+"</label>"},get_field_attr_html:function(e){return _.map(e,function(e,t){return t+'="'+e+'"'}).join(" ")}}),o=n.extend({className:"upfront-field-wrap upfront-field-wrap-text",render:function(){this.$el.html(""),this.options.compact||this.$el.append(this.get_label_html()),this.$el.append(this.get_field_html());var t=this;this.get_field().keyup(function(){""===e(this).val()?e(this).addClass("upfront-field-empty"):e(this).hasClass("upfront-field-empty")&&e(this).removeClass("upfront-field-empty")}).trigger("keyup").change(function(){t.trigger("changed",t.get_value())}),this.trigger("rendered")},get_field_html:function(){var e={type:"text",class:"upfront-field upfront-field-text",id:this.get_field_id(),name:this.get_field_name(),value:this.get_saved_value()};return this.options.compact?(e.placeholder=this.label,this.$el.attr("title",this.label)):this.options.placeholder&&(e.placeholder=this.options.placeholder),"<input "+this.get_field_attr_html(e)+" />"}}),a=n.extend({className:"upfront-field-wrap upfront-field-wrap-title",render:function(){this.$el.html(""),this.label&&this.$el.append('<div class="upfront-field-title"><span>'+this.label+"</span></div>")},get_field_html:function(){return""}}),p=o.extend({is_edited:!1,className:"upfront-field-wrap upfront-field-wrap-text upfront-field-wrap-toggleable",render:function(){if(o.prototype.render.call(this),this.is_edited)return!1;this.$el.append(' <a href="#" class="upfront-toggleable-button">Edit</a>');var t=this;this.$el.on("click",".upfront-toggleable-button",function(i){i.preventDefault(),i.stopPropagation();var s=e(this),l=t.get_field();s.hide(),l.replaceWith(t.get_editable_html()),t.is_edited=!0})},has_been_edited:function(){return this.is_edited},reset_state:function(){this.is_edited=p.prototype.is_edited},get_field_html:function(){return this.is_edited?this.get_editable_html():this.get_toggleable_html()},get_field:function(){return this.is_edited?o.prototype.get_field.call(this):this.$el.find(".upfront-field-toggleable-value")},get_value:function(){return this.is_edited?o.prototype.get_value.call(this):e.trim(this.get_field().text())},set_value:function(e){return this.is_edited?this.get_field().val(e):this.get_field().text(e)},get_toggleable_html:function(){var e=this.get_value()||this.get_saved_value();return'<span class="upfront-field-toggleable-value">'+e+"</span>"},get_editable_html:function(){var e={type:"text",class:"upfront-field upfront-field-text upfront-field-toggleable",id:this.get_field_id(),name:this.get_field_name(),value:this.get_value()||this.get_saved_value()};return"inline"===this.options.label_style&&(e.class+=" upfront-has_inline_label"),this.options.compact?(e.placeholder=this.label,this.$el.attr("title",this.label)):this.options.placeholder&&(e.placeholder=this.options.placeholder),"<input "+this.get_field_attr_html(e)+" />"}}),r=n.extend({className:"upfront-field-wrap upfront-field-wrap-button",events:{click:"on_click"},render:function(){this.$el.html(""),this.options.compact||this.$el.append(this.get_label_html()),this.options.info&&this.$el.append(this.get_info_html()),this.$el.append(this.get_field_html());this.options.classname&&this.$el.addClass(this.options.classname),this.trigger("rendered"),this.delegateEvents()},get_info_html:function(){return'<span class="button-info">'+this.options.info+"</span>"},get_field_html:function(){var e={type:"button",class:"upfront-field upfront-field-button",id:this.get_field_id(),name:this.get_field_name(),value:this.label};return this.options.compact?(e.placeholder=this.label,this.$el.attr("title",this.label)):this.options.placeholder&&(e.value=this.options.placeholder),"<input "+this.get_field_attr_html(e)+" />"}}),d=o.extend({get_field_html:function(){var e={type:"email",class:"upfront-field upfront-field-text upfront-field-email",id:this.get_field_id(),name:this.get_field_name(),value:this.get_saved_value()};return this.options.compact?(e.placeholder=this.label,this.$el.attr("title",this.label)):this.options.placeholder&&(e.placeholder=this.options.placeholder),"<input "+this.get_field_attr_html(e)+" />"}}),h=o.extend({className:"upfront-field-wrap upfront-field-wrap-text upfront-field-wrap-textarea",get_field_html:function(){var e={cols:"40",rows:"5",class:"upfront-field upfront-field-text upfront-field-textarea",id:this.get_field_id(),name:this.get_field_name()};return this.options.compact?(e.placeholder=this.label,this.$el.attr("title",this.label)):this.options.placeholder&&(e.placeholder=this.options.placeholder),"<textarea "+this.get_field_attr_html(e)+">"+this.get_saved_value()+"</textarea>"}}),c=o.extend({className:"upfront-field-wrap upfront-field-wrap-number",get_field_html:function(){var e={type:"number",class:"upfront-field upfront-field-number",id:this.get_field_id(),name:this.get_field_name(),value:this.get_saved_value()};return"undefined"!=typeof this.options.min&&(e.min=this.options.min),"undefined"!=typeof this.options.max&&(e.max=this.options.max),"undefined"!=typeof this.options.step&&(e.step=this.options.step)," <input "+this.get_field_attr_html(e)+" /> "+(this.options.suffix?this.options.suffix:"")}}),u=o.extend({className:"upfront-field-wrap upfront-field-wrap-number-unit",initialize:function(e){o.prototype.initialize.call(this,e),this.options=e;var i={model:this.options.model,className:"upfront-field-wrap upfront-field-wrap-select upfront-number-unit-select",default_value:"px",values:[{label:t.percent,value:"%"},{label:t.px,value:"px"},{label:t.em,value:"em"}],name:e.name+"-unit",change:function(t){this.model.set(e.name+"-unit",t)}};this.dropdown=new b(i)},render:function(){o.prototype.render.call(this,this.options),this.dropdown.render(),this.dropdown.delegateEvents(),this.$el.find(".upfront-field-number-unit-wrapper").append(this.dropdown.$el)},get_field_html:function(){var e={type:"number",class:"upfront-field upfront-field-number-unit",id:this.get_field_id(),name:this.get_field_name(),value:this.get_saved_value()};return"undefined"!=typeof this.options.min&&(e.min=this.options.min),"undefined"!=typeof this.options.max&&(e.max=this.options.max),"undefined"!=typeof this.options.step&&(e.step=this.options.step),'<div class="upfront-field-number-unit-wrapper"><input '+this.get_field_attr_html(e)+" /></div>"}}),f=o.extend(_.extend({},i.Upfront_Icon_Mixin,{className:"upfront-field-wrap upfront-field-wrap-slider",initialize:function(e){this.options=e,f.__super__.initialize.apply(this,arguments);var t=this,i={range:this.getOption("range","min"),min:this.getOption("min",0),max:this.getOption("max",0),step:this.getOption("step",1),orientation:this.getOption("orientation","horizontal"),value:this.get_saved_value()};this.value=this.get_saved_value(),"undefined"==typeof this.value&&(this.value=i.min),this.options.callbacks&&_.extend(i,this.options.callbacks),i.slide=function(e,i){var s=i.value;t.value=s,t.$("input").val(t.value).trigger("change"),t.options.valueTextFilter&&(s=t.options.valueTextFilter(s)),t.$(".upfront-field-slider-value").text(s),t.options.callbacks&&t.options.callbacks.slide&&t.options.callbacks.slide(e,i)},this.on("rendered",function(){var e=t.$("#"+t.get_field_id());"vertical"==i.orientation&&e.addClass("upfront-field-slider-vertical"),e.slider(i)})},get_field_html:function(){var e='<input type="hidden" name="'+this.get_field_name()+'" value="'+this.value+'">',t=this.value;return this.options.info&&(e+='<div class="upfront-field-info">'+this.options.info+"</div>"),e+='<div class="upfront-field upfront-field-slider" id="'+this.get_field_id()+'"></div>',this.options.valueTextFilter&&(t=this.options.valueTextFilter(t)),e+='<div class="upfront-field-slider-value"> '+t+"</div>"},getOption:function(e,t){return this.options[e]?this.options[e]:t}})),g=o.extend({className:"upfront-field-wrap upfront-field-wrap-hidden",get_field_html:function(){var e={type:"hidden",id:this.get_field_id(),name:this.get_field_name(),class:"upfront-field upfront-field-hidden",value:this.get_saved_value()};return" <input "+this.get_field_attr_html(e)+" /> "}}),m=o.extend({className:"upfront-field-wrap upfront-field-wrap-color sp-cf",defaults:{blank_alpha:1,autoHide:!0,hideOnOuterClick:!0},spectrumDefaults:{clickoutFiresChange:!0,showSelectionPalette:!0,showAlpha:!0,showPalette:!0,localStorageKey:"spectrum.recent_colors",palette:s.colors.pluck("color").length?s.colors.pluck("color"):[],maxSelectionSize:10,preferredFormat:"hex",showButtons:!1,showInput:!0,allowEmpty:!0,appendTo:"parent"},events:{"change .upfront_color_picker_rgba input":"rgba_sidebar_changed","change .sp-input":"sp_input_changed","click .upfront_color_picker_reset":"set_to_blank"},initialize:function(i){this.options=_.extend({},this.defaults,i),this.field_options=_.extend({},this.defaults,i),this.options.blank_alpha=_.isUndefined(this.options.blank_alpha)?1:this.options.blank_alpha,this.sidebar_template=_.template(l);var s=this,n="object"==typeof this.options.spectrum?_.extend({},this.spectrumDefaults,this.options.spectrum):this.spectrumDefaults;this.rgba={r:0,g:0,b:0,a:0},this.spectrumOptions=n,n.move=_.bind(this.on_spectrum_move,this),n.show=_.bind(this.on_spectrum_show,this),n.beforeShow=_.bind(this.on_spectrum_beforeShow,this);var o=function(e){s.options.spectrum&&s.options.spectrum.hide&&s.options.spectrum.hide(e)};n.hide=o,n.autoHide||(n.hide=function(e){s.color=e,o(e),s.$(".sp-replacer").addClass("sp-active"),s.$(".sp-container").removeClass("sp-hidden")}),this.l10n_update=_.debounce(function(){e(".sp-container").each(function(){e(this).find(".sp-input-container").attr("data-label",t.current_color).end().find(".sp-palette-container").attr("data-label",t.theme_colors).end().find(".sp-palette-row:last").attr("data-label",t.recent_colors)})}),m.__super__.initialize.apply(this,arguments),this.on("rendered",this._rendered)},_rendered:function(){var e=this;this.$("input[name="+this.get_field_name()+"]").spectrum(this.spectrumOptions),this.$spectrum=this.$("input[name="+this.get_field_name()+"]"),this.$spectrum.on("reflow.spectrum move.spectrum change",this.l10n_update),this.$(".sp-container").append("<div class='color_picker_rgb_container'></div>"),this.$(".sp-replacer").append("<div class='color_picker_rgb_preview'></div>"),this.update_input_border_color(this.get_saved_value()),this.update_color_picker_preview(this.get_saved_value()),this.$(".sp-container").data("field_color",this),this.$(".sp-container").data("$spectrum",this.$spectrum),this.$spectrum.on("change.spectrum",function(t){e.options.spectrum&&e.options.spectrum.choose&&e.color&&e.options.spectrum.choose(e.color),e.options.autoHide!==!0&&(setTimeout(function(){e.$(".sp-replacer").removeClass("sp-active"),e.$(".sp-container").addClass("sp-hidden")}),Upfront.Events.trigger("color:spectrum:hide"))}),this.$(".sp-container").find(".sp-choose").text(Upfront.Settings.l10n.global.content.ok)},on_spectrum_move:function(t,i){if(!_.isEmpty(t)){this.color=t;var s=t.toRgbString();e(".sp-dragger").css({"border-top-color":s,"border-right-color":s}),this.update_input_border_color(t.toRgbString()),this.update_color_picker_preview(t.toRgbString()),this.update_input_val(s),this.rgba=_.extend(this.rgba,t.toRgb()),this.render_sidebar_rgba(this.rgba)}this.options.spectrum&&this.options.spectrum.move&&this.options.spectrum.move(t),this.toggle_alpha_selector(t,i)},on_spectrum_show:function(t){Upfront.Events.trigger("color:spectrum:show");var i=e(".sp-input"),s=i.val();if(!_.isEmpty(t)){this.color=t;var l=t.toRgbString();this.rgba=_.extend(this.rgba,t.toRgb()),this.update_input_border_color(t.toRgbString()),this.update_color_picker_preview(t.toRgbString()),this.render_sidebar_rgba(this.rgba),this.update_input_val(l)}if(!_.isEmpty(s)&&!this.is_hex(s)){var n=tinycolor(s);i.val(n.toRgbString())}if(this.options.spectrum&&this.options.spectrum.show&&this.options.spectrum.show(t),e(".sp-container").not(this.$(".sp-container")).each(function(){var t=e(this),i=t.data("sp-options");i&&i.flat||t.addClass("sp-hidden")}),!_.isEmpty(t)){var o=this;tinycolor(t);setTimeout(function(){o.toggle_alpha_selector(t)},100)}!this.options.spectrum||this.options.spectrum.flat||this.field_options&&this.field_options.flat||!this.field_options.hideOnOuterClick||e("html").on("mousedown",_.bind(this.hide_on_outer_click,this))},on_spectrum_beforeShow:function(t){t instanceof Object&&e.extend(t,tinycolor.prototype),this.color=t,this.update_palette(),this.$("input[name="+this.get_field_name()+"]").spectrum("option","palette",this.options.palette),this.options.spectrum&&this.options.spectrum.beforeShow&&this.options.spectrum.beforeShow(t),this.$(".sp-container").data("sp-options",this.options.spectrum)},render:function(){m.__super__.render.apply(this,arguments),this.stopListening(Upfront.Events,"theme_colors:update");var e=_.debounce(this.update_palette,200);if(this.listenTo(Upfront.Events,"theme_colors:update",e,this),"right"===this.options.label_position){var t=this.$el.find(".sp-replacer"),i=this.$el.find(".upfront-field-label");i.insertAfter(t),i.addClass("upfront-color-field-label-right"),t.addClass("upfront-color-field-right")}},hide_on_outer_click:function(t){if(!this.$(".sp-container").hasClass("sp-hidden")){var i=e(t.target);i.is(".sp-container")||i.parents(".sp-container").length||(this.revert(),this.$(".sp-container").addClass("sp-hidden"),Upfront.Events.trigger("color:spectrum:hide"),e("html").off("mousedown",_.bind(this.hide_on_outer_click,this)))}},revert:function(){this.$spectrum.trigger("click.spectrum"),this.options.spectrum&&"function"==typeof this.options.spectrum.change&&this.options.spectrum.change(this.color),this.color&&this.color.toRgbString&&(this.update_input_border_color(this.color.toRgbString),this.update_color_picker_preview(this.color.toRgbString()))},update_palette:function(){this.$spectrum&&this.$spectrum.spectrum&&this.$spectrum.spectrum("option","palette",s.colors.pluck("color").length?s.colors.pluck("color"):[])},is_hex:function(e){return e.indexOf("#")!==-1},get_field_html:function(){var e={type:"text",class:"upfront-field upfront-field-color",id:this.get_field_id(),name:this.get_field_name(),value:this.get_saved_value()};return" <input "+this.get_field_attr_html(e)+" /> "+(this.options.suffix?this.options.suffix:"")},get_saved_value:function(){if(this.property)return this.use_breakpoint_property?Upfront.Util.colors.to_color_value(this.model.get_breakpoint_property_value(this.property_name,!0)):this.property.get("value");if(this.model){var e=this.model.get(this.name);return e?e:this.default_value}return this.default_value},update_input_border_color:function(e){var t=this.$el.find(".sp-preview"),i=this;setTimeout(function(){i.$el.find(".upfront_color_picker_rgb_main").css({backgroundColor:e})},10),t.css({backgroundColor:e}),"rgba(0, 0, 0, 0)"!==e?(t.removeClass("uf-unset-color"),this.$el.find(".sp-replacer").removeClass("uf-unset-color-wrapper")):0===t.closest(".theme_colors_empty_picker").length&&(t.addClass("uf-unset-color"),this.$el.find(".sp-replacer").addClass("uf-unset-color-wrapper"))},update_input_val:function(e){this.$(".sp-input").val(e)},render_sidebar_rgba:function(e){var t=this;this.$(".color_picker_rgb_container").html(this.sidebar_template(e)),this.$(".upfront_color_picker_reset").on("click",function(e){e.preventDefault(),t.set_to_blank()})},update_color_picker_preview:function(e){if(this.is_hex(e)){var t=tinycolor(e);e=t.toRgbString()}"undefined"!=typeof this.field_options.ufc_index?this.$(".color_picker_rgb_preview").html("#ufc"+this.field_options.ufc_index):(this.$(".color_picker_rgb_preview").html(e),this.$(".sp-alpha-overlay").remove())},rgba_sidebar_changed:function(t){var i=e(t.target),s=i.data("type"),l=parseFloat(i.val()),n=this.$spectrum.spectrum("get"),o={};o[s]=l,n=tinycolor(_.extend(n.toRgb(),o)),this.$spectrum.spectrum("set",n.toRgbString()),this.update_input_border_color(n.toRgbString()),this.update_color_picker_preview(n.toRgbString()),this.update_input_val(n.toRgbString()),this.render_sidebar_rgba(n.toRgb()),this.options.spectrum&&"function"==typeof this.options.spectrum.move&&this.options.spectrum.move(n),this.options.spectrum&&"function"==typeof this.options.spectrum.change&&this.options.spectrum.change(n),t.stopPropagation(),t.preventDefault(),this.$spectrum.trigger("dragstop.spectrum")},sp_input_changed:function(t){var i=tinycolor(e(t.target).val());this.options.spectrum&&"function"==typeof this.options.spectrum.move&&this.options.spectrum.move(i),this.options.spectrum&&"function"==typeof this.options.spectrum.change&&this.options.spectrum.change(i),this.update_input_border_color(i.toRgbString),this.update_color_picker_preview(i.toRgbString())},set_to_blank:function(){var e="rgba(0, 0, 0, "+(_.isUndefined(this.options.blank_alpha)?1:this.options.blank_alpha)+")",t=tinycolor(e);t.reset=!0,this.rgba={r:0,g:0,b:0,a:0},this.$spectrum.spectrum("set",t.toRgbString()),this.update_input_border_color(e),this.update_color_picker_preview(e),this.update_input_val("#000000"),this.render_sidebar_rgba(this.rgba),this.options.spectrum&&"function"==typeof this.options.spectrum.move&&this.options.spectrum.move(t),this.options.spectrum&&"function"==typeof this.options.spectrum.change&&this.options.spectrum.change(t),this.options&&"function"==typeof this.options.move&&this.options.move(t),this.options&&"function"==typeof this.options.change&&this.options.change(t)},get_value:function(){return this.$el.find(".sp-preview-inner").css("background-color")},set_value:function(e){Upfront.Util.colors.is_theme_color(e)&&(e=Upfront.Util.colors.get_color(e));var t=tinycolor(e);this.color=t,this.$spectrum.spectrum("set",t)},toggle_alpha_selector:function(i){if(!_.isEmpty(i)){var s=this.$(".sp-alpha");Upfront.Views.Theme_Colors.colors.is_theme_color(i)?(s.addClass("sp-alpha-disabled sp-alpha-lower-opacity"),$overlay=e("<span class='sp-alpha-overlay' title='"+t.theme_colors_opacity_disabled+"'>"+t.theme_colors_opacity_disabled+"</span>").on("click",function(e){e.stopPropagation(),e.preventDefault()}),this.$(".sp-alpha-overlay").length||s.before($overlay)):(s.removeClass("sp-alpha-disabled sp-alpha-lower-opacity"),this.$(".sp-alpha-overlay").remove())}}}),v=n.extend(_.extend({},i.Upfront_Icon_Mixin,{get_values_html:function(){return _.map(this.options.values,this.get_value_html,this).join("")},set_value:function(e){this.$el.find('[value="'+e+'"]').trigger("click")}})),b=v.extend(_.extend({},i.Upfront_Scroll_Mixin,{events:{"click .upfront-field-select":"openOptions","mouseup .upfront-field-select":"onMouseUp","change .upfront-field-select-option input":"onChange","click .upfront-field-select-option label":"onOptionClick"},onOptionClick:function(t){if(!this.multiple){if(t.stopPropagation(),e(this).closest(".upfront-field-select-option").hasClass("upfront-field-select-option-disabled"))return;e(t.currentTarget).siblings("input").not(":checked")&&e(t.currentTarget).siblings("input").click(),this.$el.find(".upfront-field-select").removeClass("upfront-field-select-expanded"),this.trigger("blur")}},openOptions:function(t){if(t&&t.stopPropagation(),!this.options.disabled){e(".upfront-field-select-expanded").removeClass("upfront-field-select-expanded"),this.$el.find(".upfront-field-select").css("min-width","").css("min-width",this.$el.find(".upfront-field-select").width()),this.$el.find(".upfront-field-select").addClass("upfront-field-select-expanded"),this.$el.addClass("upfront-field-wrap-select-expanded");var i=this;_.delay(function(){var t=i.$el.parents("#sidebar-ui").length,s=i.$el.parents("#element-settings-sidebar").length,l=i.$el.parents("#region-settings-sidebar").length,n=46;if(1==t||1==s||1==l){var o=i.$el.find(".upfront-field-select-options"),a=o.parent(),p=a.offset().top-e("#element-settings-sidebar").offset().top;p+=n,o.css("width",a.width()+3),o.css("top",p+"px"),Upfront.Util.isRTL()?o.css("right",e(window).width()-a.offset().left-a.width()+"px"):o.css("left",a.offset().left+"px"),o.css("display","block")}},10),e(".sidebar-panel-content, #sidebar-scroll-wrapper").on("scroll",this,this.on_scroll),this.trigger("focus")}},on_scroll:function(e){var t=e.data;t.$el.find(".upfront-field-select").removeClass("upfront-field-select-expanded"),t.trigger("blur")},onMouseUp:function(e){e.stopPropagation()},onChange:function(){this.update_select_display_value(),this.trigger("changed",this.get_value())},selected_state:"checked",className:"upfront-field-wrap upfront-field-wrap-select",render:function(){this.$el.html(""),this.label&&this.$el.append(this.get_label_html()),this.$el.append(this.get_field_html()),this.stop_scroll_propagation(this.$el.find(".upfront-field-select-options")),this.multiple||this.get_saved_value()||this.$el.find(".upfront-field-select-option:eq(0) input").prop("checked",!0),this.update_select_display_value(),this.options.width&&this.$el.find(".upfront-field-select").css("width",this.options.width),this.options.additional_classes&&this.$el.addClass(this.options.additional_classes),this.trigger("rendered")},update_select_display_value:function(){var t=this.options.select_label?this.options.select_label:this.options.placeholder?this.options.placeholder:"",i=this.$el.find(".upfront-field-select-value"),s=this.$el.find(".upfront-field-select-option input:checked");if(1!=s.length||this.multiple){var l=[];s.each(function(){l.push(e(this).closest(".upfront-field-select-option").text())}),i.text(0===s.length?t:l.join(", "))}else{var n=s.closest(".upfront-field-select-option"),o=n.text(),a=n.find(".upfront-field-icon").clone();i.html(""),a&&i.append(a),i.append("<span>"+o+"</span>")}this.$el.find(".upfront-field-select-option").each(function(){e(this).find("input:checked").length>0?e(this).addClass("upfront-field-select-option-selected"):e(this).removeClass("upfront-field-select-option-selected")})},get_field_html:function(){var e={class:"upfront-field-select upfront-no-select",id:this.get_field_id()};return e.class+=" upfront-field-select-"+(this.options.multiple?"multiple":"single"),this.options.disabled&&(e.class+=" upfront-field-select-disabled"),"zebra"==this.options.style&&(e.class+=" upfront-field-select-zebra"),"<div "+this.get_field_attr_html(e)+'><div class="upfront-field-select-value"></div><ul class="upfront-field-select-options">'+this.get_values_html()+"</ul></div>"},get_value_html:function(e,t){var i=this.get_field_id()+"-"+t,s={type:this.multiple?"checkbox":"radio",id:i,name:this.get_field_name(),class:"upfront-field-"+(this.multiple?"checkbox":"radio"),value:e.value},l=this.get_saved_value(),n="upfront-field-select-option";e.disabled&&(s.disabled="disabled",n+=" upfront-field-select-option-disabled");var o=this.options.icon_class?this.options.icon_class:null;this.multiple&&_.contains(l,e.value)?s.checked="checked":this.multiple||l!=e.value||(s.checked="checked"),s.checked&&(n+=" upfront-field-select-option-selected"),n+=" upfront-field-select-option-"+(0===t%2?"odd":"even");var a="<input "+this.get_field_attr_html(s)+" />";return'<li class="'+n+'"><label for="'+i+'">'+this.get_icon_html(e.icon,o)+'<span class="upfront-field-label-text">'+e.label+"</span></label>"+a+"</li>"}})),$=b.extend({events:{"change select":"on_change","click .chosen-container .chosen-single":"openOptions"},multiple:!1,initialize:function(e){this.options=e,n.prototype.initialize.call(this,e)},render:function(){var e=this;this.$el.html(""),this.label&&this.$el.append(this.get_label_html()),this.$el.append(this.get_field_html()),this.stop_scroll_propagation(this.$el.find(".upfront-field-select-options")),this.multiple||this.get_saved_value()||this.$el.find(".upfront-field-select-option:eq(0) input").prop("checked",!0),this.update_select_display_value(),this.options.width&&this.$el.find(".upfront-field-select").css("width",this.options.width),this.options.additional_classes&&this.$el.addClass(this.options.additional_classes),this.$el.find("select").on("chosen:hiding_dropdown",function(){e.allowMouseWheel()}),this.trigger("rendered")},get_field_html:function(){var e=this.multiple?"multiple":"";return['<select class="upfront-chosen-select"',e,' data-placeholder="',this.options.placeholder,'">',this.get_values_html(),"</select>"].join("")},get_value_html:function(e,t){var i="";return e.value===this.options.default_value&&(i=' selected="selected"'),['<option value="',e.value,'"',i,">",e.label,"</option>"].join("")},on_change:function(e){this.allowMouseWheel(),this.$el.find(".chosen-drop").css("display","none"),this.trigger("changed")},get_value:function(){return this.$el.find("select").val()},set_value:function(e){this.$el.find("select").val(e).trigger("chosen:updated")},openOptions:function(t){e(".sidebar-panel-content .sidebar-tab-content, #sidebar-scroll-wrapper").bind("mousewheel",function(){return!1});var i=this;_.delay(function(){var t=i.$el.parents("#sidebar-ui").length,s=i.$el.parents("#element-settings-sidebar").length,l=44;if(1==t||1==s){var n=i.$el.find(".chosen-drop"),o=n.parent(),a=o.offset().top-e("#element-settings-sidebar").offset().top+o.height();a+=l,n.css("width",o.width()),n.css("top",a+"px"),n.css("left",o.offset().left+"px"),n.css("display","block")}},20),e(".sidebar-panel-content, #sidebar-scroll-wrapper").on("scroll",this,this.closeChosen),i.$el.find(".chosen-drop").show(),this.$el.addClass("upfront-field-wrap-select-expanded")},closeChosen:function(e){var t=e.data,i=t.$el.parents("#sidebar-ui").length,s=t.$el.parents("#element-settings-sidebar").length;1!=i&&1!=s||t.$el.find(".chosen-drop").css("display","none"),t.$el.removeClass("upfront-field-wrap-select-expanded"),t.$el.find("select").trigger("chosen:close"),t.allowMouseWheel()},allowMouseWheel:function(){e(".sidebar-panel-content .sidebar-tab-content, #sidebar-scroll-wrapper").unbind("mousewheel")}}),w=$.extend({events:{"change select":"on_change","click .chosen-container .chosen-single":"openOptions"},multiple:!1,get_field_html:function(){var e=this.multiple?"multiple":"";return['<div class="upfront-select-font"><select class="upfront-chosen-select-typeface"',e,' data-placeholder="',this.options.placeholder,'">',this.get_values_html(),"</select></div>"].join("")},get_value_html:function(e,t){var i="",s=this.get_saved_value();e.value===s&&(i=' selected="selected"')}}),v=n.extend(_.extend({},i.Upfront_Icon_Mixin,{get_values_html:function(){return _.map(this.options.values,this.get_value_html,this).join("")},set_value:function(e){this.$el.find('[value="'+e+'"]').trigger("click")}})),b=v.extend(_.extend({},i.Upfront_Scroll_Mixin,{events:{"click .upfront-field-select-value":"openOptions","mouseup .upfront-field-select":"onMouseUp","change .upfront-field-select-option input":"onChange","click .upfront-field-select-option label":"onOptionClick"},onOptionClick:function(t){if(!this.multiple){if(t.stopPropagation(),e(this).closest(".upfront-field-select-option").hasClass("upfront-field-select-option-disabled"))return;e(t.currentTarget).siblings("input").not(":checked")&&e(t.currentTarget).siblings("input").click(),this.$el.find(".upfront-field-select").removeClass("upfront-field-select-expanded"),this.trigger("blur")}},openOptions:function(t){if(t&&t.stopPropagation(),!this.options.disabled){e(".upfront-field-select-expanded").removeClass("upfront-field-select-expanded"),this.$el.find(".upfront-field-select").css("min-width","").css("min-width",this.$el.find(".upfront-field-select").width()),this.$el.find(".upfront-field-select").addClass("upfront-field-select-expanded");var i=this;_.delay(function(){var t=i.$el.parents("#sidebar-ui").length,s=i.$el.parents("#element-settings-sidebar").length,l=i.$el.parents("#region-settings-sidebar").length,n=1;if(1==t||1==s||1==l){var o=i.$el.find(".upfront-field-select-options"),a=o.parent(),p=a.offset().top-e("#element-settings-sidebar").offset().top;p+=n,o.css("width",a.width()+3),o.css("top",p+"px"),Upfront.Util.isRTL()?o.css("right",e(window).width()-a.offset().left-a.width()+"px"):o.css("left",a.offset().left+"px"),o.css("display","block")}},10),e(".sidebar-panel-content, #sidebar-scroll-wrapper").on("scroll",this,this.on_scroll),this.trigger("focus")}},on_scroll:function(e){var t=e.data;t.$el.find(".upfront-field-select").removeClass("upfront-field-select-expanded"),t.trigger("blur")},onMouseUp:function(e){e.stopPropagation()},onChange:function(){this.update_select_display_value(),this.trigger("changed",this.get_value())},selected_state:"checked",className:"upfront-field-wrap upfront-field-wrap-select",render:function(){this.$el.html(""),this.label&&this.$el.append(this.get_label_html()),this.$el.append(this.get_field_html()),this.stop_scroll_propagation(this.$el.find(".upfront-field-select-options")),this.multiple||this.get_saved_value()||this.$el.find(".upfront-field-select-option:eq(0) input").prop("checked",!0),this.update_select_display_value(),this.options.width&&this.$el.find(".upfront-field-select").css("width",this.options.width),this.options.additional_classes&&this.$el.addClass(this.options.additional_classes),this.trigger("rendered")},update_select_display_value:function(){var t=this.options.select_label?this.options.select_label:this.options.placeholder?this.options.placeholder:"",i=this.$el.find(".upfront-field-select-value"),s=this.$el.find(".upfront-field-select-option input:checked");
if(1!=s.length||this.multiple){var l=[];s.each(function(){l.push(e(this).closest(".upfront-field-select-option").text())}),i.text(0===s.length?t:l.join(", "))}else{var n=s.closest(".upfront-field-select-option"),o=n.text(),a=n.find(".upfront-field-icon").clone();i.html(""),a&&i.append(a),i.append("<span>"+o+"</span>")}this.$el.find(".upfront-field-select-option").each(function(){e(this).find("input:checked").length>0?e(this).addClass("upfront-field-select-option-selected"):e(this).removeClass("upfront-field-select-option-selected")})},get_field_html:function(){var e={class:"upfront-field-select upfront-no-select",id:this.get_field_id()};return e.class+=" upfront-field-select-"+(this.options.multiple?"multiple":"single"),this.options.disabled&&(e.class+=" upfront-field-select-disabled"),"zebra"==this.options.style&&(e.class+=" upfront-field-select-zebra"),"<div "+this.get_field_attr_html(e)+'><div class="upfront-field-select-value"></div><ul class="upfront-field-select-options">'+this.get_values_html()+"</ul></div>"},get_value_html:function(e,t){var i=this.get_field_id()+"-"+t,s={type:this.multiple?"checkbox":"radio",id:i,name:this.get_field_name(),class:"upfront-field-"+(this.multiple?"checkbox":"radio"),value:e.value},l=this.get_saved_value(),n="upfront-field-select-option";e.disabled&&(s.disabled="disabled",n+=" upfront-field-select-option-disabled");var o=this.options.icon_class?this.options.icon_class:null;this.multiple&&_.contains(l,e.value)?s.checked="checked":this.multiple||l!=e.value||(s.checked="checked"),s.checked&&(n+=" upfront-field-select-option-selected"),n+=" upfront-field-select-option-"+(0===t%2?"odd":"even");var a="<input "+this.get_field_attr_html(s)+" />";return'<li class="'+n+'"><label for="'+i+'">'+this.get_icon_html(e.icon,o)+'<span class="upfront-field-label-text">'+e.label+"</span></label>"+a+"</li>"}})),$=b.extend({events:{"change select":"on_change","click .chosen-container .chosen-single":"openOptions"},multiple:!1,initialize:function(e){this.options=e,n.prototype.initialize.call(this,e)},render:function(){var e=this;this.$el.html(""),this.label&&this.$el.append(this.get_label_html()),this.$el.append(this.get_field_html()),this.stop_scroll_propagation(this.$el.find(".upfront-field-select-options")),this.multiple||this.get_saved_value()||this.$el.find(".upfront-field-select-option:eq(0) input").prop("checked",!0),this.update_select_display_value(),this.options.width&&this.$el.find(".upfront-field-select").css("width",this.options.width),this.options.additional_classes&&this.$el.addClass(this.options.additional_classes),this.$el.find("select").on("chosen:hiding_dropdown",function(){e.allowMouseWheel()}),this.trigger("rendered")},get_field_html:function(){var e=this.multiple?"multiple":"";return['<select class="upfront-chosen-select"',e,' data-placeholder="',this.options.placeholder,'">',this.get_values_html(),"</select>"].join("")},get_value_html:function(e,t){var i="";return e.value===this.options.default_value&&(i=' selected="selected"'),['<option value="',e.value,'"',i,">",e.label,"</option>"].join("")},on_change:function(e){this.allowMouseWheel(),this.$el.find(".chosen-drop").css("display","none"),this.trigger("changed")},get_value:function(){return this.$el.find("select").val()},set_value:function(e){this.$el.find("select").val(e).trigger("chosen:updated")},openOptions:function(t){e(".sidebar-panel-content .sidebar-tab-content, #sidebar-scroll-wrapper").bind("mousewheel",function(){return!1});var i=this;_.delay(function(){var t=i.$el.parents("#sidebar-ui").length,s=i.$el.parents("#element-settings-sidebar").length,l=1;if(1==t||1==s){var n=i.$el.find(".chosen-drop"),o=n.parent(),a=o.offset().top-e("#element-settings-sidebar").offset().top+o.height();a+=l,n.css("width",o.width()),n.css("top",a+"px"),n.css("left",o.offset().left+"px"),n.css("display","block")}},20),e(".sidebar-panel-content, #sidebar-scroll-wrapper").on("scroll",this,this.closeChosen),i.$el.find(".chosen-drop").show()},closeChosen:function(e){var t=e.data,i=t.$el.parents("#sidebar-ui").length,s=t.$el.parents("#element-settings-sidebar").length;1!=i&&1!=s||t.$el.find(".chosen-drop").css("display","none"),t.$el.find("select").trigger("chosen:close"),t.allowMouseWheel()},allowMouseWheel:function(){e(".sidebar-panel-content .sidebar-tab-content, #sidebar-scroll-wrapper").unbind("mousewheel")}}),w=$.extend({events:{"change select":"on_change","click .chosen-container .chosen-single":"openOptions"},multiple:!1,get_field_html:function(){var e=this.multiple?"multiple":"";return['<div class="upfront-select-font"><select class="upfront-chosen-select-typeface"',e,' data-placeholder="',this.options.placeholder,'">',this.get_values_html(),"</select></div>"].join("")},get_value_html:function(e,t){var i="",s=this.get_saved_value();return e.value===s&&(i=' selected="selected"'),['<option value="',e.value,'"',i,' style="font-family: ',e.value,'">',e.label,"</option>"].join("")},render:function(){$.prototype.render.call(this);var t=this;e(".upfront-chosen-select-typeface",this.$el).chosen({width:this.options.select_width}),setTimeout(function(){t.set_option_font(t.get_saved_value())},50)},on_change:function(e){this.trigger("changed",this.get_value()),this.$el.find(".chosen-drop").css("display","none"),this.set_option_font(this.get_value())},set_option_font:function(e){this.$el.find(".chosen-single").css("font-family",e)},openOptions:function(e){$.prototype.openOptions.call(this)}}),y=$.extend({events:{"change select":"on_change","click .chosen-container .chosen-single":"openOptions"},multiple:!1,get_field_html:function(){var e=this.multiple?"multiple":"";return['<div class="upfront-select-font"><select class="upfront-chosen-select-style"',e,' data-placeholder="',this.options.placeholder,'">',this.get_values_html(),"</select></div>"].join("")},get_value_html:function(e,t){var i="",s=this.options.font_family,l=Upfront.Views.Font_Model.parse_variant(e.value),n=this.get_saved_value();e.value===n&&(i=' selected="selected"');var o=this.map_labels(l.weight,l.style);return['<option value="',e.value,'"',i,' style="font-family: ',s,"; font-weight: ",l.weight,"; font-style: ",l.style,' ">',o,"</option>"].join("")},render:function(){$.prototype.render.call(this);var t=this;e(".upfront-chosen-select-style",this.$el).chosen({width:this.options.select_width,disable_search:!0}),setTimeout(function(){t.set_option_font(t.get_saved_value())},50)},map_labels:function(e,i){var s,l={100:t.label_thin,200:t.label_extra_light,300:t.label_light,400:t.label_regular,500:t.label_medium,600:t.label_semi_bold,700:t.label_bold,800:t.label_extra_bold,900:t.label_ultra_bold};return s=!_.isUndefined(e)&&e.match(/^(\d+)/)?l[e]:e,"italic"==i&&(s+=" "+i),s},on_change:function(e){this.trigger("changed",this.get_value()),this.$el.find(".chosen-drop").css("display","none"),this.set_option_font(this.get_value())},set_option_font:function(e){var t=this.$el.parent().parent().find(".upfront-chosen-select-typeface").val(),i=Upfront.Views.Font_Model.parse_variant(e);this.$el.find(".chosen-single").css({"font-family":t,"font-weight":i.weight,"font-style":i.style})},openOptions:function(e){$.prototype.openOptions.call(this)}}),k=$.extend({events:{"change select":"on_change","click .chosen-container-multi":"openOptions"},multiple:!0,get_field_html:function(){var e=this.multiple?"multiple":"";return['<select class="upfront-chosen-select-multiple"',e,' data-placeholder="',this.options.placeholder,'">',this.get_values_html(),"</select>"].join("")},get_value_html:function(e,t){var i="",s=this.get_saved_value();return _.contains(s,e.value)&&(i=' selected="selected"'),['<option value="',e.value,'"',i,">",e.label,"</option>"].join("")},render:function(){$.prototype.render.call(this);e(".upfront-chosen-select-multiple",this.$el).chosen({width:this.options.select_width})},on_change:function(e){this.trigger("changed",this.get_value()),this.$el.find(".chosen-drop").css("display","none")},openOptions:function(e){$.prototype.openOptions.call(this)}}),x=v.extend({selected_state:"checked",render:function(){var t=this;this.$el.html(""),this.label&&this.$el.append(this.get_label_html()),this.$el.append(this.get_field_html()),this.$el.on("change",".upfront-field-multiple input",function(){t.$el.find(".upfront-field-multiple").each(function(){e(this).find("input:checked").size()>0?e(this).addClass("upfront-field-multiple-selected"):e(this).removeClass("upfront-field-multiple-selected")}),t.trigger("changed",t.get_value())}),this.trigger("rendered")},get_field_html:function(){return this.get_values_html()},get_value_html:function(e,t){var i=this.get_field_id()+"-"+t,s="upfront-field-multiple",l={type:this.type,id:i,name:this.get_field_name(),value:e.value,class:"upfront-field-"+this.type},n=this.get_saved_value(),o=this.options.icon_class?this.options.icon_class:null;return this.options.layout&&(s+=" upfront-field-multiple-"+this.options.layout),e.disabled&&(l.disabled="disabled",s+=" upfront-field-multiple-disabled"),this.multiple&&_.contains(n,e.value)?l.checked="checked":this.multiple||n!=e.value||(l.checked="checked"),e.checked&&(l.checked="checked"),l.checked&&(s+=" upfront-field-multiple-selected"),'<span class="'+s+'"><input '+this.get_field_attr_html(l)+' /><label for="'+i+'">'+this.get_icon_html(e.icon,o)+'<span class="upfront-field-label-text">'+e.label+"</span></label></span>"}}),C=x.extend({className:"upfront-field-wrap upfront-field-wrap-multiple upfront-field-wrap-radios",type:"radio"}),S=C.extend({className:"upfront-field-wrap upfront-field-wrap-multiple upfront-field-wrap-radios-inline",type:"radio",render:function(){C.prototype.render.call(this),this.$el.find(".upfront-field-multiple").wrapAll('<div class="upfront-field-wrap-radios-wrapper" />')}}),O=x.extend({className:"upfront-field-wrap upfront-field-wrap-multiple upfront-field-wrap-checkboxes",type:"checkbox",multiple:!0}),U=O.extend({events:{"click .upfront-field-label-text":"click_label"},className:"upfront-field-wrap upfront-field-wrap-multiple upfront-field-wrap-toggle",type:"checkbox",multiple:!1,click_label:function(e){e.preventDefault(),this.$el.find(".upfront_toggle_checkbox").click()},get_value_html:function(e,t){var i=this.get_field_id()+"-"+t,s="upfront-field-multiple upfront-field-wrap-toggle",l={type:this.type,id:i,name:this.get_field_name(),value:e.value,class:"upfront_toggle_checkbox upfront-field-"+this.type},n=this.get_saved_value();this.options.icon_class?this.options.icon_class:null;return this.options.layout&&(s+=" upfront-field-multiple-"+this.options.layout),e.disabled&&(l.disabled="disabled",s+=" upfront-field-multiple-disabled"),this.multiple&&_.contains(n,e.value)?l.checked="checked":this.multiple||n!=e.value||(l.checked="checked"),e.checked&&(l.checked="checked"),l.checked&&(s+=" upfront-field-multiple-selected"),'<div class="'+s+' upfront_toggle_field"><input '+this.get_field_attr_html(l)+' /><label for="'+i+'" class="upfront_toggle_field_label"><span class="upfront_toggle_field_inner"></span><span class="upfront_toggle_field_switch"></span></label><span class="upfront-field-label-text">'+e.label+"</span></div>"}}),T=O.extend({className:"upfront-field-wrap upfront-field-wrap-multiple upfront-field-wrap-checkboxes upfront-field-wrap-optional",events:{"change input":"onChange"},initialize:function(e){var t=this;T.__super__.initialize.apply(this,arguments),this.options=e,this.on("panel:set",function(){this.panel.on("rendered",function(){t.onChange()})}),e.onChange&&(this.onChange=e.onChange)},onChange:function(){var t=this.$("input"),i=this.panel.$("input[name="+this.options.relatedField+"]").closest(".upfront-field-wrap");t.is(":checked")?i.show():i.hide(),e("#settings").height(this.panel.$(".upfront-settings_panel").outerHeight()),this.model.set_property(this.options.property,this.get_value())}}),z=n.extend(_.extend({},i.Upfront_Scroll_Mixin,{events:{"click .upfront-suggest-add":"add_list","focus .upfront-field-text-suggest":"reveal_suggest","keyup .upfront-field-text-suggest":"update_suggest"},multiple:!0,selected_state:"checked",added_list:[],checked_list:[],suggest_list:[],render:function(){var i=this;this.$el.html(""),this.label&&this.$el.append(this.get_label_html()),this.$el.append('<div class="upfront-suggest-wrap" />');var s=this.$el.find(".upfront-suggest-wrap");s.append(this.get_field_html()),s.append('<div class="upfront-suggest-list-wrap upfront-no-select" />'),this.checked_list=this.get_saved_value();var l=this.$el.find(".upfront-suggest-list-wrap");l.append('<ul class="upfront-suggest-lists">'+this.get_suggest_list_html()+"</ul>"),l.append('<div class="upfront-suggest-add-wrap"><span class="upfront-suggest-add-value"></span><span class="upfront-suggest-add">'+t.add_new+"</span></div>"),this.stop_scroll_propagation(this.$el.find(".upfront-suggest-lists")),this.$el.on("change",".upfront-suggest-list input",function(){var t=e(this).val();!e(this).is(":checked")&&_.contains(i.checked_list,t)?i.checked_list=_.without(i.checked_list,t):i.checked_list.push(t),i.trigger("changed")}),this.$el.on("click",function(e){e.stopPropagation()}),e("#settings").on("click",".upfront-settings_panel",function(){i.$el.find(".upfront-suggest-list-wrap").removeClass("upfront-suggest-list-wrap-expanded")}),this.trigger("rendered")},reveal_suggest:function(){this.$el.find(".upfront-suggest-list-wrap").addClass("upfront-suggest-list-wrap-expanded"),this.update_suggest()},update_suggest:function(){var e=this.get_field_input_value();this.$el.find(".upfront-suggest-lists").html(this.get_suggest_list_html()),e?(this.$el.find(".upfront-suggest-add-wrap").show(),this.$el.find(".upfront-suggest-add-value").text(e),this.$el.find(".upfront-suggest-add").toggle(!_.contains(this.suggest_list,e))):this.$el.find(".upfront-suggest-add-wrap").hide()},get_field_html:function(){var e={type:"text",class:"upfront-field upfront-field-text upfront-field-text-suggest",id:this.get_field_id()};return this.options.placeholder&&(e.placeholder=this.options.placeholder),"<input "+this.get_field_attr_html(e)+" />"},get_suggest_list_html:function(){var e=this.get_field_input_value(),t=!!e&&new RegExp("("+e+")","ig"),i=this.get_suggest_list(t),s=this;return _.map(i,function(e,i){var l=s.get_field_id()+"-"+i,n={type:"checkbox",id:l,name:s.get_field_name(),value:e,class:"upfront-field-checkbox"};_.contains(s.checked_list,e)&&(n.checked="checked");var o=t?e.replace(t,'<span class="upfront-suggest-match">$1</span>'):e;return'<li class="upfront-suggest-list"><input '+s.get_field_attr_html(n)+' /><label for="'+l+'">'+o+"</label></li>"}).join("")},get_suggest_list:function(e){var t=[];return _.each([this.options.source,this.added_list,this.get_saved_value()],function(i,s){_.each(i,function(i){2==s&&_.contains(t,i)||!(e&&i.match(e)||!e)||t.push(i)})}),this.suggest_list=t,t},get_field_input_value:function(){return this.$el.find("#"+this.get_field_id()).val()},empty_field_input_value:function(){return this.$el.find("#"+this.get_field_id()).val("")},add_list:function(e){var t=this.get_field_input_value();this.added_list.push(t),this.checked_list.push(t),this.empty_field_input_value(),this.update_suggest()}})),R=b.extend({initialize:function(e){b.prototype.initialize.call(this,e),this.options.values=this.get_anchors()},get_anchors:function(){var e=Settings_AnchorTrigger.prototype.get_anchors.call(this),t=[];return _(e).each(function(e){t.push({label:e,value:e})}),t}}),N=Backbone.View.extend({tagName:"li",events:{"change input":"on_change"},className:function(){var e="upfront-field-select-option";return this.model.get("default")&&(e+=" upfront-field-select-option-disabled"),this.model.get("enabled")&&(e+=" upfront-field-select-option-selected"),e},template:'<label><span class="upfront-field-label-text">{{ name }} {[ if (width > 0) { ]}({{width}}px){[ } ]}</span></label><input type="checkbox" class="upfront-field-checkbox" value="{{ id }}" {[ if (is_default) { ]} disabled="disabled"{[ } ]}{[ if (enabled) { ]} checked="checked"{[ } ]}>',initilize:function(e){this.options=e||{},this.listenTo(this.model,"change",this.render)},on_change:function(e){this.model.set({enabled:this.$el.find("input").is(":checked")})},render:function(){var e=this.model.toJSON();return e.is_default=e.default,this.$el.append(_.template(this.template,e)),this}}),M=b.extend({className:"upfront-field-select upfront-no-select upfront-field-compact-label-select",template:'<ul class="upfront-field-select-options"><li class="upfront-field-select-option"><label><span class="upfront-field-label-text">{{ label_text }}</span></label></li></ul></div>',initialize:function(e){this.options=e||{},this.listenTo(this.collection,"add remove change:name change:width",this.render)},render:function(){this.$el.html(""),this.$el.append(_.template(this.template,this.options)),this.$el.addClass(" upfront-field-select-"+(this.options.multiple?"multiple":"single")),this.options.disabled&&this.$el.addClass("upfront-field-select-disabled"),"zebra"==this.options.style&&this.$el.addClass("upfront-field-select-zebra"),_.each(this.collection.models,function(e){var t=new N({model:e});t.render(),this.$el.find("ul").append(t.el)},this)},onOptionClick:function(e){this.$el.toggleClass("compact-label-select-open"),b.prototype.onOptionClick.call(this,e)}}),j=n.extend({className:"upfront-field-complex_field-boolean_toggleable_text upfront-field-multiple",tpl:'<input type="checkbox" class = "upfront-field-checkbox" /> <label><span class="upfront-field-label-text">{{element_label}}</span></label> <div class="upfront-embedded_toggleable" style="display:none">{{field}}<div class="upfront-embedded_toggleable-notice">'+t.anchor_nag+"</div></div>",initialize:function(e){n.prototype.initialize.call(this,e),this.options.field=new o(this.options)},render:function(){var e=this;this.$el.empty(),this.$el.append(this.get_field_html()),this.$el.on("click",":checkbox",function(t){t.stopPropagation(),e.field_toggle.apply(e)}),this.model.get_property_value_by_name(this.options.field.get_name())&&(this.$el.find(":checkbox").attr("checked",!0),this.check_value(),this.field_toggle()),this.$el.on("keyup",'[name="'+this.options.field.get_name()+'"]',function(t){t.stopPropagation(),e.check_value.apply(e)}),setTimeout(function(){e.trigger("anchor:updated")},50)},field_toggle:function(){this.$el.find(":checkbox").is(":checked")?this.$el.find(".upfront-embedded_toggleable").show():this.$el.find(".upfront-embedded_toggleable").hide(),this.property.set({value:this.get_value()}),this.trigger("anchor:updated")},check_value:function(){var e=this.$el.find('[name="'+this.options.field.get_name()+'"]'),t=this.$el.find(".upfront-embedded_toggleable"),i=e.length&&e.val?e.val():"";t.removeClass("error").removeClass("ok"),i.length&&!i.match(/^[a-zA-Z]+$/)?t.addClass("error"):i.length&&t.addClass("ok"),this.property.set({value:this.get_value()})},get_field_html:function(){this.options.field.render();var e=this.options.field.$el;return _.template(this.tpl,_.extend({},this.options,{field:e.html()}))},get_value:function(){var e=this.$el.find(":checkbox"),t=this.$el.find('[name="'+this.options.field.get_name()+'"]'),i=t.val().replace(/[^a-zA-Z]/g,"");return e.is(":checked")&&i?i:""}});return{Field:n,Text:o,Title:a,Button:r,Email:d,Textarea:h,Color:m,Multiple_Suggest:z,Chosen_Select:$,Typeface_Chosen_Select:w,Typeface_Style_Chosen_Select:y,Multiple_Chosen_Select:k,Number:c,Number_Unit:u,Slider:f,Select:b,Radios:C,Radios_Inline:S,Checkboxes:O,Toggle:U,Hidden:g,Anchor:R,Optional:T,Field_Compact_Label_Select_Option:N,Field_Compact_Label_Select:M,Field_Complex_Toggleable_Text_Field:j,ToggleableText:p}})}(jQuery);