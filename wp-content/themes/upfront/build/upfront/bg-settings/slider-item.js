!function(e){var t=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;upfrontrjs.define(["scripts/upfront/bg-settings/mixins"],function(i){var s=Upfront.Views.Editor.Settings.Item.extend(_.extend({},i,{group:!1,initialize:function(e){var i=this,s=function(){var e=this.get_value();this.model.set_breakpoint_property(this.property_name,e)},n={transition:new Upfront.Views.Editor.Field.Select({model:this.model,label:t.slider_transition,property:"background_slider_transition",use_breakpoint_property:!0,default_value:"crossfade",icon_class:"upfront-region-field-icon",values:[{label:t.slide_down,value:"slide-down"},{label:t.slide_up,value:"slide-up"},{label:t.slide_left,value:"slide-left"},{label:t.slide_right,value:"slide-right"},{label:t.crossfade,value:"crossfade"}],change:s,rendered:function(){this.$el.addClass("uf-bgsettings-slider-transition")}}),control:new Upfront.Views.Editor.Field.Select({model:this.model,property:"background_slider_control",use_breakpoint_property:!0,default_value:"always",label:t.show_ctrl,values:[{label:t.always,value:"always"},{label:t.on_hover,value:"hover"}],change:s,rendered:function(){this.$el.addClass("uf-bgsettings-slider-control")}}),control_style:new Upfront.Views.Editor.Field.Select({model:this.model,property:"background_slider_control_style",use_breakpoint_property:!0,default_value:"both",label:t.controls_style,values:[{label:Upfront.Settings.l10n.slider_element.dots,value:"dots"},{label:Upfront.Settings.l10n.slider_element.arrows,value:"arrows"},{label:Upfront.Settings.l10n.slider_element.both,value:"both"}],change:s,rendered:function(){this.$el.addClass("uf-bgsettings-slider-control-style")}}),rotate:new Upfront.Views.Editor.Field.Toggle({model:this.model,property:"background_slider_rotate",use_breakpoint_property:!0,default_value:!0,layout:"horizontal-inline",multiple:!1,values:[{label:t.autorotate_each,value:!0}],change:function(){var e=this.get_value();this.property.set({value:!!e})},rendered:function(){this.$el.addClass("uf-bgsettings-slider-rotate")}}),rotate_time:new Upfront.Views.Editor.Field.Number({model:this.model,property:"background_slider_rotate_time",use_breakpoint_property:!0,default_value:5,min:1,max:60,step:1,suffix:t.seconds,change:s,rendered:function(){this.$el.addClass("uf-bgsettings-slider-time")}})};this.$el.addClass("uf-bgsettings-item uf-bgsettings-slideritem"),e.fields=_.map(n,function(e){return e}),this.slides_item=new l({model:this.model,title:t.slides_order}),_.isUndefined(e.slides_item_el)?this.on("panel:set",function(){i.panel.settings.push(i.slides_item),i.slides_item.panel=i.panel,i.slides_item.trigger("panel:set")}):(this.slides_item.render(),e.slides_item_el.append(this.slides_item.$el)),this.on("show",function(){var e=this.model.get_breakpoint_property_value("background_slider_images",!0);e||i.upload_slider_images(),i.slides_item.trigger("show")}),this.on("hide",function(){i.slides_item.trigger("hide")}),this.bind_toggles(),this.constructor.__super__.initialize.call(this,e)},upload_slider_images:function(){var e=this;Upfront.Views.Editor.ImageSelector.open({multiple:!0,multiple_sizes:!1}).done(function(t){var i=[];_.each(t,function(e,t){t=parseInt(t,10),t&&i.push(t)}),e.model.set_breakpoint_property("background_slider_images",i),e.slides_item.update_slider_slides(),Upfront.Views.Editor.ImageSelector.close()})}})),l=Upfront.Views.Editor.Settings.Item.extend(_.extend({},i,{initialize:function(t){var i=this;this.$el.on("click",".upfront-bg-slider-add-image",function(e){e.preventDefault(),e.stopPropagation(),Upfront.Views.Editor.ImageSelector.open({multiple:!0,multiple_sizes:!1}).done(function(e){var t=_.clone(i.model.get_breakpoint_property_value("background_slider_images",!0)||[]);_.each(e,function(e,i){i=parseInt(i,10),i&&t.push(i)}),i.model.set_breakpoint_property("background_slider_images",t),Upfront.Views.Editor.ImageSelector.close(),i.update_slider_slides()})}),this.$el.on("click",".upfront-bg-slider-delete-image",function(t){t.preventDefault(),t.stopPropagation();var s=e(this).closest(".upfront-bg-slider-image"),l=s.data("image-id"),n=s.index(),r=_.clone(i.model.get_breakpoint_property_value("background_slider_images",!0)||[]);_.isString(l)&&l.match(/^[0-9]+$/)&&(l=parseInt(l,10)),n!=-1&&r.length>0&&r.splice(n,1),i.model.set_breakpoint_property("background_slider_images",r),s.remove()}),this.on("show",function(){i.update_slider_slides()}),this.$el.addClass("uf-bgsettings-item uf-bgsettings-slider-slidesitem"),this.bind_toggles(),this.constructor.__super__.initialize.call(this,t)},update_slider_slides:function(){var t=this,i=t.model.get_breakpoint_property_value("background_slider_images",!0),s=e('<div class="upfront-bg-slider-add-image upfront-icon upfront-icon-add-slide"></div>'),l=this.$el.find(".upfront-settings-item-content");l.html(""),i.length>0?Upfront.Views.Editor.ImageEditor.getImageData(i).done(function(n){var r=n.data.images;_.each(i,function(t){var i=_.isNumber(t)||t.match(/^\d+$/)?r[t]:_.find(r,function(e){return e.full[0].split(/[\\\/]/).pop()==t.split(/[\\\/]/).pop()}),s=e('<div class="upfront-bg-slider-image" />');s.data("image-id",t),"undefined"!=typeof i.thumbnail&&s.css({background:'url("'+i.thumbnail[0]+'") no-repeat 50% 50%',backgroundSize:"100% auto"}),s.append('<span href="#" class="upfront-bg-slider-delete-image"></span>'),l.append(s)}),l.hasClass("ui-sortable")?l.sortable("refresh"):l.sortable({items:">  .upfront-bg-slider-image",update:function(){var i=[];l.find(".upfront-bg-slider-image").each(function(){var t=e(this).data("image-id");t=parseInt(t,10),t&&i.push(t)}),t.model.set_breakpoint_property("background_slider_images",i)}}),l.append(s)}):l.append(s)}}));return s})}(jQuery);